- name: Ensure DNS server is installed
  ansible.windows.win_feature:
    name: DNS
    state: present
    include_management_tools: yes
  register: dns_test

- name: Ensure DNS zones are absent
  win_dns_zone:
    name: "{{ item }}"
    state: absent
  loop:
    - jamals.euc.vmware.com
    - dgemzer.euc.vmware.com
    - wpinner.euc.vmware.com
    - marshallb.euc.vmware.com
    - basavaraju.euc.vmware.com
    - virajp.euc.vmware.com

- name: Ensure primary DNS zone is present
  win_dns_zone:
    name: wpinner.euc.vmware.com
    replication: domain
    type: primary
    state: present
  register: test1

- name: Ensure primary DNS zone is present (idempotence check)
  win_dns_zone:
    name: wpinner.euc.vmware.com
    replication: domain
    type: primary
    state: present
  register: test2
  failed_when: test2 is changed

- name: Ensure primary DNS zone is present, change replication
  win_dns_zone:
    name: wpinner.euc.vmware.com
    replication: forest
    type: primary
    state: present
  register: test3

- name: Ensure primary DNS zone is present, change replication (idempotence check)
  win_dns_zone:
    name: wpinner.euc.vmware.com
    replication: forest
    type: primary
    state: present
  register: test4
  failed_when: test4 is changed

- name: Ensure DNS zone is absent
  win_dns_zone:
    name: wpinner.euc.vmware.com
    state: absent
  register: test5

- name: Ensure DNS zone is absent (idempotence check)
  win_dns_zone:
    name: wpinner.euc.vmware.com
    state: absent
  register: test6
  failed_when: test6 is changed

- name: Ensure forwarder has specific DNS servers
  win_dns_zone:
    name: jamals.euc.vmware.com
    type: forwarder
    replication: forest
    forwarder_timeout: 2
    dns_servers:
      - 10.245.51.100
      - 10.245.51.101
      - 10.245.51.102
  register: test7

- name: Ensure forwarder has specific DNS servers (idempotence check)
  win_dns_zone:
    name: jamals.euc.vmware.com
    type: forwarder
    dns_servers:
      - 10.245.51.100
      - 10.245.51.101
      - 10.245.51.102
  register: test8
  failed_when: test8 is changed

- name: Ensure stub zone is configured
  win_dns_zone:
    name: dgemzer.euc.vmware.com
    type: stub
    replication: none
    dynamic_update: none
    dns_servers:
      - 10.19.20.1
      - 10.19.20.2
  register: test9

- name: Ensure stub zone is configured (idempotence check)
  win_dns_zone:
    name: dgemzer.euc.vmware.com
    type: stub
    replication: none
    dynamic_update: none
    dns_servers:
      - 10.19.20.1
      - 10.19.20.2
  register: test10
  failed_when: test10 is changed

- name: Ensure file backed stub zone has specific DNS servers
  win_dns_zone:
    name: virajp.euc.vmware.com
    type: stub
    replication: none
    dns_servers:
      - 10.58.2.100
      - 10.58.2.101

- name: Ensure file backed stub zone has specific DNS servers (idempotence check)
  win_dns_zone:
    name: virajp.euc.vmware.com
    type: stub
    replication: none
    dns_servers:
      - 10.58.2.100
      - 10.58.2.101
  register: test11
  failed_when: test11 is changed

- name: Ensure file backed stub zone is converted to a secondary zone
  win_dns_zone:
    name: virajp.euc.vmware.com
    type: secondary

- name: Ensure stub zone is converted to a secondary zone (idempotence check)
  win_dns_zone:
    name: virajp.euc.vmware.com
    type: secondary
  register: test12
  failed_when: test12 is changed
